DELIMITER $$
CREATE PROCEDURE RegisterSchoolCoordinator(
    IN a_email VARCHAR(50),
    IN a_firstname VARCHAR(50),
    IN a_middlename VARCHAR(50),
    IN a_lastname VARCHAR(50),
    IN a_phone_number VARCHAR(50),
    IN a_password VARCHAR(50)    
)
BEGIN
    IF EXISTS (SELECT 1 FROM SchoolCoordinator WHERE email = a_email) THEN
        SIGNAL SQLSTATE '45000' 
            SET MESSAGE_TEXT = 'Email is already registered';
    ELSEIF EXISTS (SELECT 1 FROM SchoolCoordinator WHERE firstname = a_firstname AND middlename = a_middlename AND lastname = a_lastname) THEN
        SIGNAL SQLSTATE '45000'
            SET MESSAGE_TEXT = 'Coordinator is already exists';
    ELSEIF EXISTS (SELECT 1 FROM SchoolCoordinator WHERE phone_number = a_phone_number) THEN
        SIGNAL SQLSTATE '45000'
            SET MESSAGE_TEXT = 'Phone number is already exists';
    ELSE
        INSERT INTO SchoolCoordinator(email, firstname, middlename, lastname, phone_number, password)
        VALUES (a_email, a_firstname, a_middlename, a_lastname, a_phone_number, a_password);
    END IF;
END $$
DELIMITER ;

DELIMITER $$
CREATE PROCEDURE HandleSchoolApproval(
    IN a_admin_id INT,
    IN a_school_coordinator_id INT,
    IN a_status VARCHAR(25)
)
BEGIN
    IF a_status = 'approved' THEN 
        UPDATE SchoolCoordinator
        SET admin_id = a_admin_id,
            is_approved = TRUE
        WHERE school_coordinator_id = a_school_coordinator_id;

    ELSEIF a_status = 'declined' THEN 
        UPDATE SchoolCoordinator
        SET admin_id = a_admin_id, 
            is_approved = FALSE
        WHERE school_coordinator_id = a_school_coordinator_id;
    END IF;
END $$
DELIMITER ;

DELIMITER $$ 
CREATE PROCEDURE RegisterHospitalCoordinator(
    IN a_email VARCHAR(50),
    IN a_firstname VARCHAR(50),
    IN a_middlename VARCHAR(50),
    IN a_lastname VARCHAR(50),
    IN a_password VARCHAR(50)
)
BEGIN
    IF EXISTS (SELECT 1 FROM HospitalCoordinator WHERE email = a_email) THEN
        SIGNAL SQLSTATE '45000'
            SET MESSAGE_TEXT = 'Email already exists';
    ELSE
        INSERT INTO HospitalCoordinator(email, firstname, middlename, lastname, password)
        VALUES(a_email, a_firstname, a_middlename, a_lastname, a_password);
    END IF;
END $$
DELIMITER ;

DELIMITER $$
CREATE PROCEDURE HandleHospitalApproval(
    IN a_admin_id INT,
    IN a_hospital_coordinator_id INT,
    IN a_status VARCHAR(25)
)
BEGIN
    IF a_status = 'approved' THEN
        UPDATE HospitalCoordinator
        SET admin_id = a_admin_id,
            is_approved = TRUE
        WHERE hospital_coordinator_id = a_hospital_coordinator_id;

    ELSEIF a_status = 'declined' THEN
        UPDATE HospitalCoordinator
        SET admin_id = a_admin_id,
            is_approved = FALSE
        WHERE hospital_coordinator_id = a_hospital_coordinator_id;
    END IF;
END $$
DELIMITER ;





DELIMITER $$
CREATE PROCEDURE AddSchool(
    IN a_school_profile LONGBLOB,
    IN a_school_name VARCHAR(255),
    IN a_school_number VARCHAR(255),
    IN a_school_code VARCHAR(255),
    IN a_school_address VARCHAR(255),
    IN a_school_bio VARCHAR(255),
    IN a_school_coordinator_id INT
)
BEGIN
    IF EXISTS (SELECT 1 FROM School WHERE school_name = a_school_name) THEN
        SIGNAL SQLSTATE '45000'
            SET MESSAGE_TEXT = 'School is already exist';
    ELSE
        INSERT INTO School(school_profile, school_name, school_number, school_code, school_address, school_bio, school_coordinator_id)
        VALUES (a_school_profile, a_school_name, a_school_number, a_school_code, a_school_address, a_school_bio, a_school_coordinator_id);
    END IF;
END $$
DELIMITER ;

DELIMITER $$

CREATE PROCEDURE AddStudent(
    IN a_student_profile LONGBLOB,
    IN a_student_firstname VARCHAR(255),
    IN a_student_middlename VARCHAR(255),
    IN a_student_lastname VARCHAR(255),
    IN a_student_address TEXT,
    IN a_phone_number VARCHAR(20),
    IN a_student_email VARCHAR(255),
    IN a_student_birthdate DATE,
    IN a_student_gender VARCHAR(255),
    IN a_school_id INT
)
BEGIN
    INSERT INTO Student(student_profile, student_firstname, student_middlename, student_lastname, student_address, phone_number, student_email, student_birthdate, student_gender, school_id)
    VALUES (a_student_profile, a_student_firstname, a_student_middlename, a_student_lastname, a_student_address, a_phone_number, a_student_email, a_student_birthdate, a_student_gender, a_school_id);
END $$

DELIMITER ;
DELIMITER $$
CREATE PROCEDURE EditCoordinatorProfile(
    IN a_school_coordinator_id INT,
    IN a_school_coordinator_profile LONGBLOB,
    IN a_email VARCHAR(50),
    IN a_firstname VARCHAR(50),
    IN a_middlename VARCHAR(50),
    IN a_lastname VARCHAR(50),
    IN a_phone_number VARCHAR(50),
    IN a_birthdate DATE,
    IN a_address TEXT,
    IN a_gender VARCHAR(50),
    IN a_bio TEXT
)
BEGIN
    -- Check if the record exists
    IF NOT EXISTS (SELECT 1 FROM SchoolCoordinator WHERE school_coordinator_id = a_school_coordinator_id) THEN
        SIGNAL SQLSTATE '45000' 
            SET MESSAGE_TEXT = 'Coordinator does not exist';
    ELSEIF EXISTS (SELECT 1 FROM SchoolCoordinator 
                   WHERE email = a_email 
                   AND school_coordinator_id <> a_school_coordinator_id) THEN
        SIGNAL SQLSTATE '45000' 
            SET MESSAGE_TEXT = 'Email is already registered';
    ELSEIF EXISTS (SELECT 1 FROM SchoolCoordinator 
                   WHERE firstname = a_firstname 
                     AND middlename = a_middlename 
                     AND lastname = a_lastname
                     AND school_coordinator_id <> a_school_coordinator_id) THEN
        SIGNAL SQLSTATE '45000'
            SET MESSAGE_TEXT = 'Coordinator already exists with the same name';
    ELSEIF EXISTS (SELECT 1 FROM SchoolCoordinator 
                   WHERE phone_number = a_phone_number
                     AND school_coordinator_id <> a_school_coordinator_id) THEN
        SIGNAL SQLSTATE '45000'
            SET MESSAGE_TEXT = 'Phone number is already registered';
    ELSE
        UPDATE SchoolCoordinator 
        SET school_coordinator_profile = a_school_coordinator_profile,
            email = a_email,
            firstname = a_firstname,
            middlename = a_middlename,
            lastname = a_lastname,
            phone_number = a_phone_number,
            birthdate = a_birthdate,
            address = a_address,
            gender = a_gender,
            bio = a_bio
        WHERE school_coordinator_id = a_school_coordinator_id;
    END IF;
END $$
DELIMITER ;

